(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[154],{3566:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hsp",function(){return n(6993)}])},6993:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return w}});var i=n(5893),s=n(7294);function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r=function t(){a(this,t)};function h(t,e,n){return t<n.x+n.width&&e<n.y+n.height&&t>=n.x&&e>=n.y}function l(t,e,n,i,s){var a=void 0===i?0:i,o=void 0===s?0:s,r=1/Math.pow(2,n);return function(t,e,n){var i=5381;return(i=33*(i=33*(i=33*i+t)+e)+n)%1e5}(Math.floor(t*r)+a,Math.floor(e*r)+o,n)}function c(t,e){var n=Math.max(t,e);return Math.ceil(Math.log2(n))}var u=function(){function t(){a(this,t),this.hashtable=new Map,this.levels=new Map}var e,n,i;return e=t,(n=[{key:"addObject",value:function(t){var e=t.getBoundingBox(),n=c(e.width,e.height),i=l(e.x,e.y,n),s=this.hashtable.get(i);s||(s=[],this.hashtable.set(i,s)),t.level=n,t.hash=i,s.push(t);var a=this.levels.get(n)||0;this.levels.set(n,a+1)}},{key:"removeObject",value:function(t){var e=t.hash,n=this.hashtable.get(e);if(1===n.length)this.hashtable.delete(e);else{var i=n.indexOf(t);n.splice(i,1)}var s=t.level,a=this.levels.get(s);a>1?this.levels.set(s,a-1):this.levels.delete(s),t.level=void 0,t.hash=void 0}},{key:"updateObject",value:function(t){var e=t.getBoundingBox(),n=t.level,i=c(e.width,e.height),s=i!==n;s||(s=t.hash!==l(e.x,e.y,i)),s&&(this.removeObject(t),this.addObject(t))}},{key:"query",value:function(t,e){var n=[],i=[-1,-1,-1,0,0,-1,0,0],s=!0,a=!1,o=void 0;try{for(var r,c=Array.from(this.levels.keys())[Symbol.iterator]();!(s=(r=c.next()).done);s=!0)for(var u=r.value,d=0;d<i.length;d+=2){var v=l(t,e,u,i[d],i[d+1]),f=this.hashtable.get(v);if(f){var b=!0,y=!1,g=void 0;try{for(var m,w=f[Symbol.iterator]();!(b=(m=w.next()).done);b=!0){var j=m.value;h(t,e,j.getBoundingBox())&&n.push(j)}}catch(p){y=!0,g=p}finally{try{b||null==w.return||w.return()}finally{if(y)throw g}}}}}catch(p){a=!0,o=p}finally{try{s||null==c.return||c.return()}finally{if(a)throw o}}return n}}])&&o(e.prototype,n),i&&o(e,i),t}();function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),t}var b=function(){function t(e,n,i,s,a,o){d(this,t),this.x=e,this.y=n,this.width=i,this.height=s,this.color=a,this.renderer=o,this.bounds=new r}return f(t,[{key:"getBoundingBox",value:function(){return this.bounds.x=this.x,this.bounds.y=this.y,this.bounds.width=this.width,this.bounds.height=this.height,this.bounds.width<0&&(this.bounds.width=-this.bounds.width,this.bounds.x+=this.bounds.width),this.bounds.height<0&&(this.bounds.height=-this.bounds.height,this.bounds.y+=this.bounds.height),this.bounds}},{key:"getColorStr",value:function(){return this.renderer.selectedObjects.includes(this)?"rgba(255, 0, 0, 0.5)":"rgba(".concat(this.color.r,", ").concat(this.color.g,", ").concat(this.color.b,", 0.25)")}}]),t}(),y=function(){function t(e){var n,i,s,a;d(this,t),this.selectedObjects=[],this.sh=new u,this.objects=[],this.random=(n=3735929054,i=3284386755,s=3203386110,a=3131746989,function(){var t=(n>>>=0)+(i>>>=0)|0;return n=i^i>>>9,i=(s>>>=0)+(s<<3)|0,s=(s=s<<21|s>>>11)+(t=t+(a=1+(a>>>=0)|0)|0)|0,(t>>>0)/4294967296}),this.tickBind=this.tick.bind(this),this.timer=0,this.canvas=e.canvas,this.context=this.canvas.getContext("2d"),this.init()}return f(t,[{key:"init",value:function(){var t=this,e=this,n=e.canvas;e.objects,e.sh;n.width=n.clientWidth*devicePixelRatio,n.height=n.clientHeight*devicePixelRatio;for(var i=0;i<15e3;i++)this.addRandomObj();this.canvas.onmousemove=function(e){t.mouseX=e.clientX*devicePixelRatio,t.mouseY=e.clientY*devicePixelRatio},this.rafHandle=requestAnimationFrame(this.tickBind)}},{key:"randomRange",value:function(t,e){return t+this.random()*(e-t)}},{key:"draw",value:function(){var t=this,e=t.canvas,n=t.context,i=t.objects;t.sh;n.fillStyle="black",n.fillRect(0,0,e.width,e.height);var s=!0,a=!1,o=void 0;try{for(var r,h=i[Symbol.iterator]();!(s=(r=h.next()).done);s=!0){var l=r.value,c=l.getBoundingBox();n.fillStyle=l.getColorStr(),n.fillRect(c.x,c.y,c.width,c.height)}}catch(u){a=!0,o=u}finally{try{s||null==h.return||h.return()}finally{if(a)throw o}}}},{key:"changeObjects",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,s=this.objects[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;a.x+=this.randomRange(-30,30),a.y+=this.randomRange(-30,30),a.width+=this.randomRange(-30,30),a.height+=this.randomRange(-30,30)}}catch(o){e=!0,n=o}finally{try{t||null==s.return||s.return()}finally{if(e)throw n}}}},{key:"updateSH",value:function(){console.time("update objects (15k)");var t=!0,e=!1,n=void 0;try{for(var i,s=this.objects[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;this.sh.updateObject(a)}}catch(o){e=!0,n=o}finally{try{t||null==s.return||s.return()}finally{if(e)throw n}}console.timeEnd("update objects (15k)")}},{key:"checkIntersections",value:function(){console.time("query"),this.selectedObjects=this.sh.query(this.mouseX,this.mouseY),console.timeEnd("query")}},{key:"addRandomObj",value:function(){var t=this.canvas,e=this.randomRange(5,100),n=this.randomRange(5,100),i=this.randomRange(-15.02*t.width,.98*t.width-e),s=this.randomRange(-15.02*t.height,.98*t.height-n),a={r:this.randomRange(0,63),g:this.randomRange(127,255),b:this.randomRange(127,255)},o=new b(i,s,e,n,a,this);this.objects.push(o),console.time("add object"),this.sh.addObject(o),console.timeEnd("add object")}},{key:"doRandomAddAndRemove",value:function(){for(var t=0;t<100;t++){var e=Math.trunc(this.randomRange(0,this.objects.length-1)),n=this.objects[e];this.objects.splice(e,1),console.time("remove object"),this.sh.removeObject(n),console.timeEnd("remove object"),this.addRandomObj()}}},{key:"tick",value:function(){this.timer<300&&(this.changeObjects(),this.timer++),this.updateSH(),this.checkIntersections(),console.log("density: "+Math.round(this.objects.length/this.sh.hashtable.size)),console.log("levels count: "+this.sh.levels.size),this.draw(),this.rafHandle=requestAnimationFrame(this.tickBind)}},{key:"destroy",value:function(){this.rafHandle&&(cancelAnimationFrame(this.rafHandle),delete this.rafHandle),this.canvas.onmousemove=null}}]),t}(),g=n(4912),m=n.n(g),w=function(){var t=(0,s.useRef)(null),e=(0,s.useRef)(null);return(0,s.useEffect)((function(){if(t.current)return e.current=new y({canvas:t.current}),function(){e.current.destroy(),e.current=null}}),[]),(0,i.jsx)("div",{className:m().scene,children:(0,i.jsx)("canvas",{ref:t,className:m().canvas})})}},4912:function(t){t.exports={scene:"hsp_page_style_scene__r2Jwo",canvas:"hsp_page_style_canvas__crqX6",widgetInfo:"hsp_page_style_widgetInfo__RxEqM",tweaks:"hsp_page_style_tweaks__8naFr"}}},function(t){t.O(0,[774,888,179],(function(){return e=3566,t(t.s=e);var e}));var e=t.O();_N_E=e}]);
//# sourceMappingURL=hsp-89b77ba059908dd2.js.map